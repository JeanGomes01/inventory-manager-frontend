<div class="p-6">
  <h2 class="text-2xl font-bold mb-8">Produtos</h2>

  <div class="flex items-center justify-between mb-4">
    <input
      type="text"
      placeholder="Buscar produto..."
      class="border p-2 rounded-md w-1/3 focus:ring-2 focus:ring-blue-400 outline-none"
      (input)="onSearch($event)"
    />

    <app-modal [isOpen]="isModalOpen" (closeModal)="closeModal()">
      <h2 class="text-xl font-bold mb-6">Adicione um Produto</h2>

      <form [formGroup]="productForm" (ngSubmit)="createProduct()" class="grid grid-cols-4 gap-4">
        <input
          type="text"
          placeholder="Nome"
          formControlName="name"
          class="border p-2 rounded-md col-span-2 focus:ring-2 focus:ring-blue-400 outline-none"
        />

        <input
          type="text"
          placeholder="Descrição"
          formControlName="description"
          class="border p-2 rounded-md col-span-2 focus:ring-2 focus:ring-blue-400 outline-none"
        />

        <input
          type="text"
          placeholder="Categoria"
          formControlName="category"
          class="border p-2 rounded-md col-span-2 focus:ring-2 focus:ring-blue-400 outline-none"
        />

        <input
          type="number"
          placeholder="Qtd"
          formControlName="quantity"
          class="border p-2 rounded-md col-span-2 focus:ring-2 focus:ring-blue-400 outline-none"
        />

        <div class="col-span-4 flex justify-end gap-3 mt-4">
          <button
            type="submit"
            class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition"
          >
            Criar Produto
          </button>

          <button
            type="button"
            class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition"
            (click)="closeModal()"
          >
            Fechar
          </button>
        </div>
      </form>
    </app-modal>
    <button class="bg-green-600 text-white px-4 py-2 rounded-md" (click)="openModal()">
      + Adicionar Produto
    </button>
  </div>

  <div class="bg-gray-50 p-6 rounded-lg shadow-inner mb-6"></div>

  <table class="table-auto w-full border border-gray-300 rounded-lg shadow">
    <thead class="bg-gray-200">
      <tr>
        <th class="p-3 text-left">Produto</th>
        <th class="p-3 text-left">Descrição</th>
        <th class="p-3 text-center">Categoria</th>
        <th class="p-3 text-center">Quantity</th>
        <th class="p-3 text-center">Ações</th>
      </tr>
    </thead>

    <tbody>
      @if (products.length > 0) {
      <tr
        *ngFor="let product of products"
        [ngClass]="{
          'bg-red-100 transition-colors duration-500': highlightedProductId === product.id,
          'bg-red-50': isLowStock(product) && highlightedProductId !== product.id
        }"
      >
        <td class="p-3">{{ product.name }}</td>
        <td class="p-3">{{ product.description || '-' }}</td>
        <td class="p-3 text-center">
          {{ product.category }}
        </td>
        <td class="p-3 text-center">{{ product.quantity || '-' }}</td>
        <td class="p-3 text-center">
          <div class="flex justify-center gap-2">
            <ng-container *ngIf="editingProductId !== product.id; else editingMode">
              <button
                (click)="updateProduct(product)"
                class="btn bg-blue-500 hover:bg-blue-600 text-white border-none px-4 py-2 text-sm rounded-md shadow-sm hover:shadow-md transition-all"
              >
                Editar
              </button>

              <button
                (click)="deleteProduct(product.id)"
                class="btn bg-red-500 hover:bg-red-600 text-white border-none px-4 py-2 text-sm rounded-md shadow-sm hover:shadow-md transition-all"
              >
                Excluir
              </button>
            </ng-container>

            <ng-template #editingMode>
              <button
                (click)="saveProduct()"
                class="btn bg-green-600 hover:bg-green-700 text-white border-none px-4 py-2 text-sm rounded-md shadow-sm hover:shadow-md transition-all"
              >
                Salvar
              </button>

              <button
                (click)="cancelEdit()"
                class="btn bg-gray-400 hover:bg-gray-500 text-white border-none px-4 py-2 text-sm rounded-md shadow-sm hover:shadow-md transition-all"
              >
                Cancelar
              </button>
            </ng-template>
          </div>
        </td>
      </tr>
      } @else {
      <tr>
        <td colspan="4" class="p-6 text-center text-gray-500 italic">Nenhum produto encontrado.</td>
      </tr>
      }
    </tbody>
  </table>
</div>
